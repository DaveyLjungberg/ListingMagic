# QuickList - Cursor Rules

You are an expert full-stack developer working on **QuickList**, a SaaS that generates AI-powered real estate listing content in 60-90 seconds.

## Project Overview

**What QuickList Does**: Real estate agents upload property photos → AI generates MLS-compliant descriptions, data extraction, and silent video slideshows.

**Tech Stack**:
- **Frontend**: Next.js 15, React 19, TypeScript, Tailwind CSS (Vercel)
- **Backend**: Python FastAPI (Railway)
- **Database**: Supabase PostgreSQL + Auth + Storage
- **AI**: GPT-4o (primary), Gemini Pro (secondary)

**URLs**:
- Frontend: https://listing-magic.vercel.app
- Backend: https://listingmagic-production.up.railway.app
- Database: https://vbfwcemtkgymygccgffl.supabase.co

## CRITICAL: Fair Housing Compliance

ALL AI-generated descriptions MUST follow Fair Housing rules:

**PROHIBITED**:
- "Step inside", "Welcome to", "Come see" (imperative language)
- "you", "your", "you'll" (second-person pronouns)
- "Perfect for families", "Ideal for retirees" (buyer-specific)
- "Master bedroom" (use "Primary bedroom")

**REQUIRED**:
- Third-person only: "This residence features..."
- Factual descriptions only
- Objective statements

## Code Structure

```
listing-magic/
├── app/                          # Next.js App Router
│   ├── dashboard/generate/       # Main generation page
│   │   ├── components/           # DescriptionsTab, MLSDataTab, ResultsTabs
│   │   ├── hooks/                # useDescriptionsState, useMLSState, useVideoGeneration
│   │   └── page.jsx              # Main orchestrator
├── libs/
│   ├── generate-api.ts           # Backend API client
│   └── supabase.ts               # Supabase client
├── python-backend/               # FastAPI backend
│   ├── endpoints/                # API endpoints
│   ├── services/                 # AI provider integrations (openai, gemini)
│   ├── compliance/               # Fair Housing validation
│   └── utils/                    # Prompts, helpers
└── .agent-workspace/             # Agent memory (READ THIS FIRST)
```

## Generation Flow (Current)

1. **Upload Photos** → Supabase Storage
2. **Analyze Photos** → GPT-4o Vision (shows "Photo X of Y" progress)
3. **Generate Public Remarks** → GPT-4o (overlay closes when done)
4. **Background Tasks** (sequential):
   - Features List → Gemini
   - Video Generation → FFmpeg (silent slideshow)
   - MLS Extraction → Gemini

**Result Tabs**: Public Remarks | Features Sheet | Video Tour

## Coding Standards

### Frontend Components
```javascript
"use client";  // Only if needed for interactivity

import { useState } from "react";
import { toast } from "react-hot-toast";
import { supabase } from "@/libs/supabase";

const ComponentName = ({ prop }) => {
  const [isLoading, setIsLoading] = useState(false);

  const handleAction = async () => {
    setIsLoading(true);
    try {
      // Action
      toast.success("Success!");
    } catch (error) {
      toast.error(error.message || "Something went wrong");
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <button
      onClick={handleAction}
      disabled={isLoading}
      className="btn btn-primary"
    >
      {isLoading ? "Loading..." : "Action"}
    </button>
  );
};

export default ComponentName;
```

### Backend Endpoints
```python
from fastapi import APIRouter, HTTPException
from pydantic import BaseModel

router = APIRouter()

@router.post("/api/endpoint")
async def endpoint_name(request: RequestModel):
    try:
        # Validation
        if not request.required_field:
            raise HTTPException(status_code=400, detail="Required")

        # Business logic
        result = await service.process(request)

        return {"success": True, "data": result}
    except Exception as e:
        logger.error(f"Error: {e}")
        raise HTTPException(status_code=500, detail="Internal error")
```

## Before Starting Any Task

1. **Read `CLAUDE.md`** - Master instructions
2. **Check `.agent-workspace/context/current-sprint.md`** - What's the focus?
3. **Check `.agent-workspace/logs/bugs/`** - Has this been solved before?
4. **Check `.agent-workspace/knowledge/error-solutions.md`** - Quick fixes

## After Completing Any Task

1. **Bug fixed?** → Add to `.agent-workspace/logs/bugs/`
2. **New pattern?** → Add to `.agent-workspace/knowledge/`
3. **Architecture decision?** → Update `context/tech-decisions.md`

## Key Files Reference

| What | Where |
|------|-------|
| Main generation UI | `app/dashboard/generate/components/DescriptionsTab.jsx` |
| MLS data display | `app/dashboard/generate/components/MLSDataTab.jsx` |
| Backend API client | `libs/generate-api.ts` |
| AI prompts | `python-backend/utils/prompt_templates.py` |
| Fair Housing rules | `python-backend/compliance/fair_housing.py` |
| Agent memory | `.agent-workspace/` |

## Known Issues (Don't Re-Debug)

- ✅ Slow generation → Use GPT-4o not GPT-4.1
- ✅ Timeout → Increased to 300s
- ✅ MLS clearing on switch → Fixed handleLoadDescListing
- ✅ Address lost on tab switch → AddressInput is controlled component
- ✅ Photos not loading → Uses setPhotosFromUrls()
- ✅ Walkthrough complexity → Feature removed (silent videos only)
- ⚠️ Photo categorization 503 → Non-blocking, low priority
- ⚠️ ATTOM tax data inconsistent → User can manually edit

## Environment

- Use Plan Mode for complex tasks
- Check existing hooks before creating new ones
- Use absolute imports with `@/` prefix
- Always handle loading states and errors
- Include proper TypeScript types
